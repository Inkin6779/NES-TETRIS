<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--<meta name="viewport" content="height=800, initial-scale=1">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="format-detection" content="telephone=yes" />
    <meta name="description" content="Simple browser-based Tetris implementation">
    <meta name="keywords" content="Tetris, FTetris, ScalaJS">
    <meta name="author" content="Cameron Reuschel">

    <link rel="shortcut icon" type="image/png" href="favicon.ico"/>
    <title>FTetris by XDracam</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="target/scala-2.12/functionaltetris-opt.js"></script>
    <script> function setHTML(id, text) {
        document.getElementById(id).innerHTML = text;
    }</script>
    <script> function getHighscore() {
        if (!document.cookie) return 0;
        const hsPart = document.cookie.split(";")[0];
        if (!hsPart) return 0;
        const hs = hsPart.split("highscore=")[1];
        return parseInt(hs) || 0;
    }</script>
    <script> function getMostLines() {
        if (!document.cookie) return 0;
        const mlPart = document.cookie.split(";")[1];
        if (!mlPart) return 0;
        const ml = mlPart.split("mostlines=")[1];
        return parseInt(ml) || 0;
    }</script>
    <script>
        var simpleRenderingMode;
        var guidelineColors;
        function startGame() {
            gameConf = {
                // the canvas
                mainCanvas: document.getElementById("mainCanv"),
                nextTileCanvas: document.getElementById("prevCanv"),
                // the point callback
                onpointchange: function (pts) {
                    if (pts > getHighscore()) {
                        document.cookie = document.cookie.replace(/highscore=(.*?);/, "highscore="+pts+";");
                        setHTML("highscore", "Highscore: " + pts.toString());
                    }
                    setHTML("score", "Score: " + pts.toString());
                },
                // the level callback
                onlevelchange: function (lvl) {
                    setHTML("level", "<b>Level: " + lvl + "</b>");
                },
                // the line clear callback
                onlineclear: function (lcs) {
                    if (lcs > getMostLines()) {
                        document.cookie = document.cookie.replace(/mostlines=(.*?);/, "mostlines="+lcs+";");
                        setHTML("mostlines", "Most lines: " + lcs.toString());
                    }
                    setHTML("linescleared", "Lines Cleared: " + lcs);
                },
                // the touch root if not the canvas
                touchRootNode: document.getElementById("touchroot"),
                simpleRenderingMode: () => simpleRenderingMode || false,
                guidelineColors: () => guidelineColors || false
            };
            FTetris.startGame(gameConf);
    }</script>
    <script> function setSimpleMode(cb) {
        simpleRenderingMode = cb.checked;
    }</script>
    <script> function setGuidelineColors(cb) {
        guidelineColors = cb.checked;
    }</script>
</head>
<body>
<div class="container container-medium">
    <div class="pb-2 mt-4 mb-2 border-bottom"><h1>TETRIS</h1></div>
    <div class="row"> <!-- justify-content-center -->
        <div class="col-auto pull-left" id="touchroot">
            <canvas width="300px" height="600px" id="mainCanv" style="margin:auto; border:2px solid #000000;">
                Your browser must support the html5 canvas. Sorry, bro.
            </canvas>
        </div>
        <div class="col-auto pull-right">
            <canvas width="120px" height="120px" id="prevCanv" style="margin:auto; border:1px solid #000000;"></canvas>
            <hr/>
            <table><tbody><tr><td>
                <p id="level" style="font-size: 20px; margin: auto;"><b>Level: 0</b></p>
            </td></tr><tr><td>
                <p id="linescleared" style="font-size: 18px; margin: auto;">Lines: 0</p>
            </td></tr><tr><td>
                <p id="score" style="font-size: 18px; margin: auto;">Score: 0</p>
            </td></tr></tbody></table>
            <hr/>
            <table><tbody><tr><td>
                <input type="checkbox" onclick="setSimpleMode(this)" id="simpleModeCheck"/>
                <label style="font-size: 14px; margin: auto;" for="simpleModeCheck">Simple Mode</label>
            </td></tr><tr><td>
                <input type="checkbox" onclick="setGuidelineColors(this)" id="guidelineColorCheck"/>
                <label style="font-size: 14px; margin: auto;" for="guidelineColorCheck">Standard Colors</label>
            </td></tr></tbody></table>
            <hr/>
            <div><button onclick="startGame()" style="margin: auto;">START GAME</button></div>
            <hr/>
            <div><p id="highscore" style="font-size: 14px; margin: auto;">Highscore: 0</p></div>
            <div><p id="mostlines" style="font-size: 14px; margin: auto;">Most lines: 0</p></div>
        </div>
    </div>
    <p>Made by <a href="https://github.com/XDracam">XDracam</a> with Love</p>
</div>

<script>document.getElementById("highscore").innerText = "Highscore: " + getHighscore().toString();</script>
<script>document.getElementById("mostlines").innerText = "Most lines: " + getMostLines().toString();</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</body>
</html>